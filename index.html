<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جمال اللغة العربية</title>
    <!-- تضمين مكتبة Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- خط خاص يدعم اللغة العربية بشكل جميل (مثل خطوط جوجل) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">a
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f7f9fb; /* خلفية فاتحة وناعمة */
        }
        .card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 0 10px -5px rgba(0, 0, 0, 0.04);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        /* لتطبيق الـ RTL (من اليمين لليسار) على النص والمحاذاة */
        .text-right { text-align: right; }
        .mx-auto { margin-left: auto; margin-right: auto; }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- شريط التنقل (Navbar) -->
    <header class="bg-white shadow-lg rounded-xl mb-10 p-4 flex justify-between items-center max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800">موقعنا</h1>
        <nav>
            <ul class="flex space-x-4 space-x-reverse text-lg">
                <li><a href="#" class="text-indigo-600 hover:text-indigo-800 transition duration-300">الرئيسية</a></li>
                <li><a href="#" class="text-gray-600 hover:text-indigo-600 transition duration-300">مقالات</a></li>
                <li><a href="#" class="text-gray-600 hover:text-indigo-600 transition duration-300">اتصل بنا</a></li>
            </ul>
        </nav>
    </header>

    <!-- القسم الرئيسي - البطل (Hero Section) -->
    <main class="max-w-7xl mx-auto">
        <section class="bg-indigo-700 text-white rounded-3xl p-10 md:p-16 mb-12 text-right">
            <div class="md:w-3/4">
                <h2 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">اكتشف جمال اللغة العربية</h2>
                <p class="text-xl md:text-2xl mb-8 opacity-90">لغة الضاد: تاريخ عريق، فنون إبداعية، وكنوز معرفية لا تنتهي.</p>
                <button class="bg-white text-indigo-700 font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-100 transition duration-300 shadow-xl">ابدأ رحلتك</button>
            </div>
        </section>

        <!-- قسم الميزات (Features) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            
            <!-- البطاقة 1 -->
            <div class="card bg-white p-6 rounded-2xl text-right">
                <div class="text-indigo-500 mb-4">
                    <!-- أيقونة تعبر عن الجمال -->
                    <svg class="h-10 w-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.4-.921 1.603-.921 2 0l1.517 3.483 3.847.414c1.018.109 1.424 1.398.674 2.083l-2.887 2.658.74 3.935c.19.999-.838 1.764-1.777 1.282L12 16.71l-3.414 1.834c-.939.482-1.967-.283-1.777-1.282l.74-3.935-2.887-2.658c-.75-.685-.344-1.974.674-2.083l3.847-.414 1.517-3.483z"></path></svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">الثراء اللغوي</h3>
                <p class="text-gray-600">تتميز اللغة العربية بثراء مفرداتها وقدرتها على التعبير عن أدق المعاني، مما يجعلها لغة الشعر والأدب.</p>
            </div>

            <!-- البطاقة 2 -->
            <div class="card bg-white p-6 rounded-2xl text-right">
                <div class="text-indigo-500 mb-4">
                    <!-- أيقونة تعبر عن التاريخ -->
                    <svg class="h-10 w-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">التاريخ العريق</h3>
                <p class="text-gray-600">ارتبطت اللغة العربية بحضارات عريقة وكانت لغة العلم والمعرفة لقرون طويلة في مختلف أنحاء العالم.</p>
            </div>

            <!-- البطاقة 3 -->
            <div class="card bg-white p-6 rounded-2xl text-right">
                <div class="text-indigo-500 mb-4">
                    <!-- أيقونة تعبر عن الفن والخط -->
                    <svg class="h-10 w-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h10m-9 4h4m1-4l3 3-3 3"></path></svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">فن الخط العربي</h3>
                <p class="text-gray-600">يشكّل الخط العربي فنًا بصريًا بحد ذاته، حيث تتشابك الحروف لتشكل لوحات فنية رائعة الجمال والإتقان.</p>
            </div>
        </div>

        <!-- قسم عن اللغة (About Section) -->
        <section class="bg-white rounded-3xl p-10 md:p-12 text-right">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-200 pb-3">اللغة العربية في العصر الحديث</h2>
            
            <div id="about-content">
                <p class="text-gray-700 text-lg leading-relaxed mb-4">
                    في الوقت الحالي، تُعد اللغة العربية واحدة من اللغات الأكثر انتشارًا في العالم، حيث يتحدثها مئات الملايين من الأشخاص كلغة أم. وهي لغة رسمية في العديد من المنظمات الدولية، بما في ذلك الأمم المتحدة.
                </p>
                <p class="text-gray-700 text-lg leading-relaxed">
                    التحدي اليوم هو ربط الأجيال الجديدة بهذا الإرث العظيم، واستخدام الأدوات التكنولوجية الحديثة لتعزيز حضورها في الفضاء الرقمي، من خلال المحتوى عالي الجودة والتطبيقات المبتكرة.
                </p>
            </div>
            
            <div class="mt-8 flex flex-col space-y-4">
                <!-- زر تلخيص النص (Gemini LLM) -->
                <button onclick="generateSummary()" class="w-full md:w-auto bg-green-500 text-white font-bold py-3 px-6 rounded-xl text-lg hover:bg-green-600 transition duration-300 shadow-lg flex items-center justify-center">
                    <svg class="w-5 h-5 ml-2 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.002 4.498L16 9l4.498-.002L21 11l-4.498 2.002L16 16l-2.002-4.498L12 11l4.498-2.002L16 6z"></path></svg>
                    تلخيص النص بواسطة الذكاء الاصطناعي ✨
                </button>

                <!-- مؤشر التحميل (Loading Indicator) -->
                <div id="loading-indicator" class="hidden text-center text-indigo-600 font-semibold mt-4">
                    <svg class="animate-spin h-5 w-5 ml-2 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    جاري توليد الملخص...
                </div>
                
                <!-- منطقة عرض الملخص -->
                <div id="summary-result" class="bg-gray-50 p-6 rounded-xl mt-6 border-r-4 border-green-500 text-right">
                    <!-- سيتم عرض الملخص هنا -->
                </div>

                <!-- زر القراءة الصوتية (Gemini TTS) -->
                <div class="flex items-center justify-end space-x-2 space-x-reverse mt-4">
                    <button id="read-aloud-btn" onclick="readAloud()" class="hidden bg-indigo-500 text-white font-bold py-2 px-4 rounded-full text-sm hover:bg-indigo-600 transition duration-300 shadow-md flex items-center">
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.899a9 9 0 010 12.728M5.818 13.097H3.5a1 1 0 01-1-1v-2a1 1 0 011-1h2.318l.724-1.447A1 1 0 017 7.05v9.899a1 1 0 01-1.458.898l-.724-1.447z"></path></svg>
                        قراءة النص بصوت ✨
                    </button>
                    <div id="tts-loading" class="hidden text-indigo-600 text-sm">...جاري التحميل</div>
                    <audio id="audio-player" controls class="hidden w-full md:w-auto h-8"></audio>
                </div>
            </div>
        </section>
    </main>

    <!-- التذييل (Footer) -->
    <footer class="mt-12 pt-8 border-t border-gray-300 max-w-7xl mx-auto text-center text-gray-600 text-sm">
        <p>&copy; 2024 جميع الحقوق محفوظة. تم إنشاؤه بواسطة نموذج Gemini.</p>
    </footer>

    <!-- JavaScript et intégration de l'API Gemini -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Initialisation de Firebase (Obligatoire pour l'environnement Canvas)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, auth, db;
        
        if (Object.keys(firebaseConfig).length > 0) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // Authentification
            async function authenticate() {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                    console.log("Firebase Authenticated successfully.");
                } catch (error) {
                    console.error("Firebase Auth error:", error);
                }
            }
            authenticate();
        }

        // --- Fonctions d'intégration Gemini API (Début) ---

        // Constantes et variables Générales
        const API_KEY = ""; // L'API Key sera fournie par l'environnement Canvas
        const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const TTS_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=";

        // Fonctions utilitaires pour TTS (Conversion PCM en WAV)
        const base64ToArrayBuffer = (base64) => {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        };

        const writeString = (view, offset, string) => {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        };

        const pcmToWav = (pcm16, sampleRate) => {
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit PCM
            const buffer = new ArrayBuffer(44 + pcm16.byteLength);
            const view = new DataView(buffer);
            let offset = 0;

            // RIFF identifier
            writeString(view, offset, 'RIFF'); offset += 4;
            // file length (size of rest of file)
            view.setUint32(offset, 36 + pcm16.byteLength, true); offset += 4;
            // RIFF type
            writeString(view, offset, 'WAVE'); offset += 4;
            // format chunk identifier
            writeString(view, offset, 'fmt '); offset += 4;
            // format chunk length
            view.setUint32(offset, 16, true); offset += 4;
            // sample format (1 for PCM)
            view.setUint16(offset, 1, true); offset += 2;
            // number of channels
            view.setUint16(offset, numChannels, true); offset += 2;
            // sample rate
            view.setUint32(offset, sampleRate, true); offset += 4;
            // byte rate (sample rate * num channels * bytes per sample)
            view.setUint32(offset, sampleRate * numChannels * bytesPerSample, true); offset += 4;
            // block align (num channels * bytes per sample)
            view.setUint16(offset, numChannels * bytesPerSample, true); offset += 2;
            // bits per sample
            view.setUint16(offset, 16, true); offset += 2;
            // data chunk identifier
            writeString(view, offset, 'data'); offset += 4;
            // data chunk length
            view.setUint32(offset, pcm16.byteLength, true); offset += 4;

            // Write PCM data
            const pcmBytes = new Uint8Array(buffer, offset);
            pcmBytes.set(new Uint8Array(pcm16.buffer));

            return new Blob([buffer], { type: 'audio/wav' });
        };

        // Fonction pour l'appel à l'API Gemini (avec Backoff)
        async function callGeminiAPI(apiUrl, payload, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && i < retries - 1) {
                            const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                            // Pas de log d'erreur de backoff, seulement un avertissement
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue;
                        }
                        const errorData = await response.json();
                        throw new Error(`Erreur HTTP: ${response.status} - ${errorData.error?.message || 'Inconnue'}`);
                    }

                    return await response.json();
                } catch (error) {
                    if (i === retries - 1) {
                        throw error;
                    }
                    if (error.message && !error.message.includes('429')) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }
            throw new Error("Échec de l'appel à l'API après plusieurs tentatives.");
        }

        // Fonction pour la génération de texte (Résumé)
        window.generateSummary = async function () {
            const content = document.getElementById('about-content').innerText;
            const summaryResult = document.getElementById('summary-result');
            const loadingIndicator = document.getElementById('loading-indicator');
            const readAloudButton = document.getElementById('read-aloud-btn');
            const summaryButton = document.querySelector('button[onclick="generateSummary()"]');

            summaryResult.innerHTML = '';
            readAloudButton.classList.add('hidden');
            summaryButton.disabled = true;
            loadingIndicator.classList.remove('hidden');

            const systemPrompt = "أنت مساعد لغوي متخصص في تلخيص النصوص العربية. قم بتلخيص النص التالي في حدود 100 كلمة، مع المحافظة على الأسلوب الجذاب.";
            const userQuery = content;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const result = await callGeminiAPI(GEMINI_API_URL + API_KEY, payload);
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || 'تعذر توليد الملخص.';
                
                // Afficher le texte généré
                summaryResult.innerHTML = `<p class="text-lg text-gray-800 leading-relaxed">${text}</p>`;
                
                // Afficher le bouton de lecture audio
                if (text !== 'تعذر توليد الملخص.') {
                    readAloudButton.dataset.textToRead = text;
                    readAloudButton.classList.remove('hidden');
                }

            } catch (error) {
                summaryResult.innerHTML = `<p class="text-red-500 text-lg">حدث خطأ أثناء توليد الملخص: ${error.message}</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
                summaryButton.disabled = false;
            }
        }

        // Fonction pour la synthèse vocale (TTS)
        window.readAloud = async function () {
            const textToRead = document.getElementById('read-aloud-btn').dataset.textToRead;
            const readAloudBtn = document.getElementById('read-aloud-btn');
            const ttsLoading = document.getElementById('tts-loading');
            const audioPlayer = document.getElementById('audio-player');

            if (!textToRead) return;

            readAloudBtn.disabled = true;
            ttsLoading.classList.remove('hidden');
            audioPlayer.classList.add('hidden');
            audioPlayer.pause();
            audioPlayer.removeAttribute('src');

            const payload = {
                contents: [{ parts: [{ text: textToRead }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        // Utiliser une voix adaptée à la langue arabe
                        voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            try {
                const result = await callGeminiAPI(TTS_API_URL + API_KEY, payload);
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                    // Extraire le taux d'échantillonnage (sample rate) du mimeType
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    if (!sampleRateMatch) throw new Error("Sample rate could not be extracted from mimeType.");
                    const sampleRate = parseInt(sampleRateMatch[1], 10);
                    
                    // Convertir Base64 en ArrayBuffer puis en Int16Array (PCM 16-bit)
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);

                    // Convertir PCM en Blob WAV
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    // Afficher le lecteur audio
                    audioPlayer.src = audioUrl;
                    audioPlayer.classList.remove('hidden');
                    // audioPlayer.play(); // Le navigateur peut bloquer l'autoplay
                } else {
                    throw new Error('Données صوتية غير صالحة تم استلامها.');
                }

            } catch (error) {
                document.getElementById('summary-result').innerHTML = `<p class="text-red-500 text-lg">حدث خطأ في توليد الصوت: ${error.message}</p>`;
                audioPlayer.classList.add('hidden');
            } finally {
                readAloudBtn.disabled = false;
                ttsLoading.classList.add('hidden');
            }
        }
        // --- Fonctions d'intégration Gemini API (Fin) ---
    </script>

</body>
</html>
